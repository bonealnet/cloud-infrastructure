#!/bin/bash
#
# JENK_LOG_CLEAN="/usr/local/sbin/jenkins_log_cleanup" && vi "${JENK_LOG_CLEAN}" && chmod 0755 "${JENK_LOG_CLEAN}";
#

# ------------------------------------------------------------
#
# Script must run as root or via sudo
#
if [ "$(id -un)" == "root" ]; then

	# Log all shell output & error output to logfile
	LOGFILE="/var/log/jenkins_log_cleanup_$(date +'%Y%m%d_%H%M%S')";
	exec > >(tee -a "${LOGFILE}" );
	exec 2>&1;



#   /var/lib/jenkins/jobs/JOB_NAME_HERE/builds/1
#   /var/lib/jenkins/jobs/JOB_NAME_HERE/builds/1/build.xml
#   /var/lib/jenkins/jobs/JOB_NAME_HERE/builds/1/log      # HUGE
#   /var/lib/jenkins/jobs/JOB_NAME_HERE/builds/1/18.log   # Small to Medium
#   /var/lib/jenkins/jobs/JOB_NAME_HERE/builds/1/workflow/28.xml # Small to Medium

# -type d \
# -type f \

PARENT_DIRNAME="/var/lib/jenkins/jobs/" && \
OLDER_THAN_DAYS=90 && \
find ${PARENT_DIRNAME} \
-maxdepth 1 \
-regex '^/var/lib/jenkins/jobs/[A-Za-z\_\-\.]+' \
-mtime +${OLDER_THAN_DAYS} \
-exec echo "$(date +'%Y-%m-%d %H:%M:%S') $(whoami)@$(hostname) | {}" \; \
;

#
# -exec printf "$(date +'%Y-%m-%d %H:%M:%S') $(whoami)@$(hostname) | " \; \
#
# -regex '^/var/lib/jenkins/jobs/[A-Za-z\_\-\.]+' \
# -regex '^/var/lib/jenkins/jobs/[A-Za-z\_\-\.]+/builds/\d+/$' \
#
# -exec rm -v -- '{}' \; \
#

fi;
