#!/bin/bash
#
# LOCAL_BIN="/usr/local/bin/get_permissons" && echo "" > "${LOCAL_BIN}" && vi "${LOCAL_BIN}" && chmod 0755 "${LOCAL_BIN}";
#

if [ -z "${1}" ]; then

	echo "$(date +'%Y-%m-%d %H:%M:%S') | ${0} | Error: empty path \${1} (filepath to stat)";

elif [ ! -e "${1}" ]; then

	echo "$(date +'%Y-%m-%d %H:%M:%S') | ${0} | Error: path \${1} not found: \"${1}\"";

else

	INFO=($(stat --dereference --format="%n %a %u %U %g %G" "${1}"));

	if [ "$?" == "0" ]; then

		STAT_NAME=${INFO[0]};
		STAT_CHMOD=$(printf "%04d" ${INFO[1]});
		STAT_UID=${INFO[2]};
		STAT_UNAME=${INFO[3]};
		STAT_GID=${INFO[4]};
		STAT_GNAME=${INFO[5]};
		STAT_TYPE=$(stat --dereference --format="%F" "${1}");

		echo "STAT_NAME=${STAT_NAME}";
		echo "STAT_TYPE=${STAT_TYPE}";
		echo "STAT_CHMOD=${STAT_CHMOD}";
		echo "STAT_UID=${STAT_UID}";
		echo "STAT_UNAME=${STAT_UNAME}";
		echo "STAT_GID=${STAT_GID}";
		echo "STAT_GNAME=${STAT_GNAME}";

		if (( (${STAT_CHMOD} & 0002) != 0 )); then # Everyone has write access
			STAT_ACCESS="1";
		elif (( (${STAT_CHMOD} & 0020) != 0 )); then # A Group has write access
				MY_GROUPS=( $(groups ${USER}) );
				for EACH_GNAME in "${MY_GROUPS[@]}"; do
					if [[ ${STAT_GNAME} == ${EACH_GNAME} ]]; then # User is a member of the group which has write-access
						STAT_ACCESS="1";
						break;
					fi;
				done
		elif (( (${STAT_CHMOD} & 0200) != 0 )); then # The owner has write access
			if [[ ${USER} == ${OWNER} ]]; then # The user IS the file-owner
				STAT_ACCESS="1";
			fi;
		fi;
	fi;
fi;

if [ -z "${STAT_ACCESS}" ]; then
	STAT_ACCESS="0";
fi;

#
# Citation(s)
#
#		Thanks to StackOverflow user [ chepner ] on forum [ https://stackoverflow.com/a/14104522 ]
#
