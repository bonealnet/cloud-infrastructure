#!/bin/bash

# fail-out if any startup errors were found
if [ "$(whoami)" != "root" ]; then
	echo "Error - ${0} requires root access. Run as user \"root\" or with the \"sudo\" command.";
	exit 1;
else
	if [ -f "/run/nginx.pid" ]; then
		echo "Reloading NGINX Service...";
		sudo nginx -t && sudo sleep 1 && sudo service nginx reload;
	else
		# PID_ROGUE_NGINX_INSTANCE=$(netstat -nlp | grep :80 | grep nginx.conf | awk '{print $7}' | cut -d/ -f 1);
		PID_ROGUE_NGINX_INSTANCE=$(netstat -nlp | grep :80 | grep nginx | awk '{print $7}' | cut -d/ -f 1);
		if [ -n "${PID_ROGUE_NGINX_INSTANCE}" ]; then
			echo "Killing Rogue NGINX Instance...";
			sudo kill "${PID_ROGUE_NGINX_INSTANCE}";
		fi;
		echo "Starting NGINX Service...";
		sudo nginx -t && sudo sleep 1 && sudo service nginx start;
	fi;
	service nginx status;
	### Create symbolic link to this script for on-the-fly nginx reloads:
	# RELOAD_NGINX="/usr/bin/reload_nginx"; vi "${RELOAD_NGINX}"; chmod 0755 "${RELOAD_NGINX}";
	# 
fi;
